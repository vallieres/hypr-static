version: 2.1

workflows:
  deploy:
    jobs:
      - deploy

jobs:
  deploy:
    docker:
      - image: cimg/base:2022.10
    working_directory: ~/project
    environment:
      HUGO_BUILD_DIR: ~/hugo/public
    steps:
      - checkout
      - add_ssh_keys
      - run: sudo apt-get update && sudo apt-get install -y --no-install-recommends git rsync
      - run: |
          echo 'opal4.opalstack.com ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDRF9dXxpdkO/sBH6iRp+s3ACw+ZWuYUrED+mw3y2Fm3JxIAP5k2duawQ3McdX8AZjLbZVdNbVI91QEHXnwhsw6D2JfaWgnRM/SvQemoe2ZXXoD/wcwgO9V+iUxFfLb9/F9idZbuoq2M1w6cWytlpw3IADoAaFY4Mspm9NzI7gVN3H3sgea6iZvSrzuxKSMMGUFTUz5kbq5BnEDzNHDtxuXUJ+zcgrebARaNA2w8G9795HBKUyxh2uIuB4q5mbYtOJblIKEUqLBP71tajZXu7r8uid6FBQlTu1hfX1XhDglKHCe611k20BtoTKnMHuHV8dNhTAZMYpNlWnt3nk62h33' >> ~/.ssh/known_hosts
          cd ~/project
          rsync -va --delete \
          --exclude '_email-simpleapp' --exclude '_theme-stack' --exclude '.circleci' --exclude '.git' --exclude 'email-templates' --exclude 'Hypr-Assets' \
          . vallieres@opal4.opalstack.com:/home/vallieres/apps/hyprsocial_beta_static
          echo "Done!"
